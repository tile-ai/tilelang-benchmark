<?xml version="1.0"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg xmlns="http://www.w3.org/2000/svg">
<g font-family="monospace" font-size="14px">
<text x="57" y="14"  fill="#3D7B7B" font-style="italic" text-anchor="end">1</text><text x="76" y="14" xml:space="preserve"><tspan fill="#AA22FF">@triton</tspan><tspan fill="#666666">.</tspan>jit<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="33" text-anchor="end"  fill="#3D7B7B" font-style="italic">2</text><text x="76" y="33" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#FF0000" font-weight="bold">def</tspan>&#160;<tspan fill="#0000FF" font-weight="bold">matmul_kernel</tspan>(<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="52" text-anchor="end"  fill="#3D7B7B" font-style="italic">3</text><text x="76" y="52" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a_ptr,&#160;b_ptr,&#160;c_ptr,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="71" text-anchor="end"  fill="#3D7B7B" font-style="italic">4</text><text x="76" y="71" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;M,&#160;N,&#160;K,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="90" text-anchor="end"  fill="#3D7B7B" font-style="italic">5</text><text x="76" y="90" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stride_am,&#160;stride_ak,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="109" text-anchor="end"  fill="#3D7B7B" font-style="italic">6</text><text x="76" y="109" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stride_bk,&#160;stride_bn,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="128" text-anchor="end"  fill="#3D7B7B" font-style="italic">7</text><text x="76" y="128" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stride_cm,&#160;stride_cn,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="147" text-anchor="end"  fill="#3D7B7B" font-style="italic">8</text><text x="76" y="147" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BLOCK_SIZE_M:&#160;tl<tspan fill="#666666">.</tspan>constexpr,&#160;BLOCK_SIZE_N:&#160;tl<tspan fill="#666666">.</tspan>constexpr,&#160;BLOCK_SIZE_K:&#160;tl<tspan fill="#666666">.</tspan>constexpr,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="166" text-anchor="end"  fill="#3D7B7B" font-style="italic">9</text><text x="76" y="166" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GROUP_SIZE_M:&#160;tl<tspan fill="#666666">.</tspan>constexpr,<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="185" text-anchor="end"  fill="#3D7B7B" font-style="italic">10</text><text x="76" y="185" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ACTIVATION:&#160;tl<tspan fill="#666666">.</tspan>constexpr<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="204" text-anchor="end"  fill="#3D7B7B" font-style="italic">11</text><text x="76" y="204" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>):<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="223" text-anchor="end"  fill="#3D7B7B" font-style="italic">12</text><text x="76" y="223" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="242" text-anchor="end"  fill="#3D7B7B" font-style="italic">13</text><text x="76" y="242" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;pid&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>program_id(axis<tspan fill="#666666">=</tspan><tspan fill="#1f77b4" font-weight="bold">0</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="261" text-anchor="end"  fill="#3D7B7B" font-style="italic">14</text><text x="76" y="261" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;num_pid_m&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>cdiv(M,&#160;BLOCK_SIZE_M)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="280" text-anchor="end"  fill="#3D7B7B" font-style="italic">15</text><text x="76" y="280" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;num_pid_n&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>cdiv(N,&#160;BLOCK_SIZE_N)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="299" text-anchor="end"  fill="#3D7B7B" font-style="italic">16</text><text x="76" y="299" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;num_pid_in_group&#160;<tspan fill="#666666">=</tspan>&#160;GROUP_SIZE_M&#160;<tspan fill="#666666">*</tspan>&#160;num_pid_n<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="318" text-anchor="end"  fill="#3D7B7B" font-style="italic">17</text><text x="76" y="318" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;group_id&#160;<tspan fill="#666666">=</tspan>&#160;pid&#160;<tspan fill="#666666">/</tspan><tspan fill="#666666">/</tspan>&#160;num_pid_in_group<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="337" text-anchor="end"  fill="#3D7B7B" font-style="italic">18</text><text x="76" y="337" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;first_pid_m&#160;<tspan fill="#666666">=</tspan>&#160;group_id&#160;<tspan fill="#666666">*</tspan>&#160;GROUP_SIZE_M<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="356" text-anchor="end"  fill="#3D7B7B" font-style="italic">19</text><text x="76" y="356" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;group_size_m&#160;<tspan fill="#666666">=</tspan>&#160;<tspan fill="#008000">min</tspan>(num_pid_m&#160;<tspan fill="#666666">-</tspan>&#160;first_pid_m,&#160;GROUP_SIZE_M)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="375" text-anchor="end"  fill="#3D7B7B" font-style="italic">20</text><text x="76" y="375" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;pid_m&#160;<tspan fill="#666666">=</tspan>&#160;first_pid_m&#160;<tspan fill="#666666">+</tspan>&#160;((pid&#160;<tspan fill="#666666">%</tspan>&#160;num_pid_in_group)&#160;<tspan fill="#666666">%</tspan>&#160;group_size_m)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="394" text-anchor="end"  fill="#3D7B7B" font-style="italic">21</text><text x="76" y="394" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;pid_n&#160;<tspan fill="#666666">=</tspan>&#160;(pid&#160;<tspan fill="#666666">%</tspan>&#160;num_pid_in_group)&#160;<tspan fill="#666666">/</tspan><tspan fill="#666666">/</tspan>&#160;group_size_m<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="413" text-anchor="end"  fill="#3D7B7B" font-style="italic">22</text><text x="76" y="413" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="432" text-anchor="end"  fill="#3D7B7B" font-style="italic">23</text><text x="76" y="432" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;offs_am&#160;<tspan fill="#666666">=</tspan>&#160;(pid_m&#160;<tspan fill="#666666">*</tspan>&#160;BLOCK_SIZE_M&#160;<tspan fill="#666666">+</tspan>&#160;tl<tspan fill="#666666">.</tspan>arange(<tspan fill="#1f77b4" font-weight="bold">0</tspan>,&#160;BLOCK_SIZE_M))&#160;<tspan fill="#666666">%</tspan>&#160;M<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="451" text-anchor="end"  fill="#3D7B7B" font-style="italic">24</text><text x="76" y="451" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;offs_bn&#160;<tspan fill="#666666">=</tspan>&#160;(pid_n&#160;<tspan fill="#666666">*</tspan>&#160;BLOCK_SIZE_N&#160;<tspan fill="#666666">+</tspan>&#160;tl<tspan fill="#666666">.</tspan>arange(<tspan fill="#1f77b4" font-weight="bold">0</tspan>,&#160;BLOCK_SIZE_N))&#160;<tspan fill="#666666">%</tspan>&#160;N<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="470" text-anchor="end"  fill="#3D7B7B" font-style="italic">25</text><text x="76" y="470" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;offs_k&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>arange(<tspan fill="#1f77b4" font-weight="bold">0</tspan>,&#160;BLOCK_SIZE_K)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="489" text-anchor="end"  fill="#3D7B7B" font-style="italic">26</text><text x="76" y="489" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;a_ptrs&#160;<tspan fill="#666666">=</tspan>&#160;a_ptr&#160;<tspan fill="#666666">+</tspan>&#160;(offs_am[:,&#160;<tspan fill="#FF0000" font-weight="bold">None</tspan>]&#160;<tspan fill="#666666">*</tspan>&#160;stride_am&#160;<tspan fill="#666666">+</tspan>&#160;offs_k[<tspan fill="#FF0000" font-weight="bold">None</tspan>,&#160;:]&#160;<tspan fill="#666666">*</tspan>&#160;stride_ak)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="508" text-anchor="end"  fill="#3D7B7B" font-style="italic">27</text><text x="76" y="508" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;b_ptrs&#160;<tspan fill="#666666">=</tspan>&#160;b_ptr&#160;<tspan fill="#666666">+</tspan>&#160;(offs_k[:,&#160;<tspan fill="#FF0000" font-weight="bold">None</tspan>]&#160;<tspan fill="#666666">*</tspan>&#160;stride_bk&#160;<tspan fill="#666666">+</tspan>&#160;offs_bn[<tspan fill="#FF0000" font-weight="bold">None</tspan>,&#160;:]&#160;<tspan fill="#666666">*</tspan>&#160;stride_bn)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="527" text-anchor="end"  fill="#3D7B7B" font-style="italic">28</text><text x="76" y="527" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="546" text-anchor="end"  fill="#3D7B7B" font-style="italic">29</text><text x="76" y="546" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#FF0000" font-weight="bold">for</tspan>&#160;k&#160;<tspan fill="#1f77b4" font-weight="bold">in</tspan>&#160;<tspan fill="#008000">range</tspan>(<tspan fill="#1f77b4" font-weight="bold">0</tspan>,&#160;tl<tspan fill="#666666">.</tspan>cdiv(K,&#160;BLOCK_SIZE_K)):<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="565" text-anchor="end"  fill="#3D7B7B" font-style="italic">30</text><text x="76" y="565" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>load(a_ptrs,&#160;mask<tspan fill="#666666">=</tspan>offs_k[<tspan fill="#FF0000" font-weight="bold">None</tspan>,&#160;:]&#160;<tspan fill="#666666">&lt;</tspan>&#160;K&#160;<tspan fill="#666666">-</tspan>&#160;k&#160;<tspan fill="#666666">*</tspan>&#160;BLOCK_SIZE_K,&#160;other<tspan fill="#666666">=</tspan><tspan fill="#1f77b4" font-weight="bold">0.0</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="584" text-anchor="end"  fill="#3D7B7B" font-style="italic">31</text><text x="76" y="584" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;b&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>load(b_ptrs,&#160;mask<tspan fill="#666666">=</tspan>offs_k[:,&#160;<tspan fill="#FF0000" font-weight="bold">None</tspan>]&#160;<tspan fill="#666666">&lt;</tspan>&#160;K&#160;<tspan fill="#666666">-</tspan>&#160;k&#160;<tspan fill="#666666">*</tspan>&#160;BLOCK_SIZE_K,&#160;other<tspan fill="#666666">=</tspan><tspan fill="#1f77b4" font-weight="bold">0.0</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="603" text-anchor="end"  fill="#3D7B7B" font-style="italic">32</text><text x="76" y="603" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;accumulator&#160;<tspan fill="#666666">=</tspan>&#160;tl<tspan fill="#666666">.</tspan>dot(a,&#160;b,&#160;accumulator,&#160;out_dtype<tspan fill="#666666">=</tspan>tl<tspan fill="#666666">.</tspan>float16)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="622" text-anchor="end"  fill="#3D7B7B" font-style="italic">33</text><text x="76" y="622" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a_ptrs&#160;<tspan fill="#666666">+</tspan><tspan fill="#666666">=</tspan>&#160;BLOCK_SIZE_K&#160;<tspan fill="#666666">*</tspan>&#160;stride_ak<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="641" text-anchor="end"  fill="#3D7B7B" font-style="italic">34</text><text x="76" y="641" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;b_ptrs&#160;<tspan fill="#666666">+</tspan><tspan fill="#666666">=</tspan>&#160;BLOCK_SIZE_K&#160;<tspan fill="#666666">*</tspan>&#160;stride_bk<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="660" text-anchor="end"  fill="#3D7B7B" font-style="italic">35</text><text x="76" y="660" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="679" text-anchor="end"  fill="#3D7B7B" font-style="italic">36</text><text x="76" y="679" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;c&#160;<tspan fill="#666666">=</tspan>&#160;accumulator<tspan fill="#666666">.</tspan>to(tl<tspan fill="#666666">.</tspan>float16)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="698" text-anchor="end"  fill="#3D7B7B" font-style="italic">37</text><text x="76" y="698" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="717" text-anchor="end"  fill="#3D7B7B" font-style="italic">38</text><text x="76" y="717" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;offs_cm&#160;<tspan fill="#666666">=</tspan>&#160;pid_m&#160;<tspan fill="#666666">*</tspan>&#160;BLOCK_SIZE_M&#160;<tspan fill="#666666">+</tspan>&#160;tl<tspan fill="#666666">.</tspan>arange(<tspan fill="#1f77b4" font-weight="bold">0</tspan>,&#160;BLOCK_SIZE_M)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="736" text-anchor="end"  fill="#3D7B7B" font-style="italic">39</text><text x="76" y="736" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;offs_cn&#160;<tspan fill="#666666">=</tspan>&#160;pid_n&#160;<tspan fill="#666666">*</tspan>&#160;BLOCK_SIZE_N&#160;<tspan fill="#666666">+</tspan>&#160;tl<tspan fill="#666666">.</tspan>arange(<tspan fill="#1f77b4" font-weight="bold">0</tspan>,&#160;BLOCK_SIZE_N)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="755" text-anchor="end"  fill="#3D7B7B" font-style="italic">40</text><text x="76" y="755" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;c_ptrs&#160;<tspan fill="#666666">=</tspan>&#160;c_ptr&#160;<tspan fill="#666666">+</tspan>&#160;stride_cm&#160;<tspan fill="#666666">*</tspan>&#160;offs_cm[:,&#160;<tspan fill="#FF0000" font-weight="bold">None</tspan>]&#160;<tspan fill="#666666">+</tspan>&#160;stride_cn&#160;<tspan fill="#666666">*</tspan>&#160;offs_cn[<tspan fill="#FF0000" font-weight="bold">None</tspan>,&#160;:]<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="774" text-anchor="end"  fill="#3D7B7B" font-style="italic">41</text><text x="76" y="774" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;c_mask&#160;<tspan fill="#666666">=</tspan>&#160;(offs_cm[:,&#160;<tspan fill="#FF0000" font-weight="bold">None</tspan>]&#160;<tspan fill="#666666">&lt;</tspan>&#160;M)&#160;<tspan fill="#666666">&amp;</tspan>&#160;(offs_cn[<tspan fill="#FF0000" font-weight="bold">None</tspan>,&#160;:]&#160;<tspan fill="#666666">&lt;</tspan>&#160;N)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="793" text-anchor="end"  fill="#3D7B7B" font-style="italic">42</text><text x="76" y="793" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;tl<tspan fill="#666666">.</tspan>store(c_ptrs,&#160;c,&#160;mask<tspan fill="#666666">=</tspan>c_mask)<tspan fill="#bbbbbb"></tspan></text>
<text x="57" y="812" text-anchor="end"  fill="#3D7B7B" font-style="italic">43</text><text x="76" y="812" xml:space="preserve"><tspan fill="#bbbbbb"></tspan></text></g></svg>
