<?xml version="1.0"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg xmlns="http://www.w3.org/2000/svg">
<g font-family="monospace" font-size="14px">
<text x="0" y="14" xml:space="preserve"><tspan fill="#FF0000" font-weight="bold">import</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">tilelang</tspan><tspan fill="#9467bd" font-weight="bold">.</tspan><tspan fill="#9467bd" font-weight="bold">language</tspan>&#160;<tspan fill="#FF0000" font-weight="bold">as</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="33" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="52" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#FF0000" font-weight="bold">def</tspan>&#160;<tspan fill="#0000FF" font-weight="bold">Matmul</tspan>(<tspan fill="#d62728" font-weight="bold">A</tspan>:&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan>Buffer,&#160;<tspan fill="#d62728" font-weight="bold">B</tspan>:&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan>Buffer,&#160;<tspan fill="#d62728" font-weight="bold">C</tspan>:&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan>Buffer):<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="71" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;<tspan fill="#FF0000" font-weight="bold">with</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">Kernel</tspan>(<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="90" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">ceildiv</tspan>(N,&#160;block_N),&#160;<tspan fill="#9467bd" font-weight="bold">ceildiv</tspan>(M,&#160;block_M),&#160;threads<tspan fill="#666666">=</tspan><tspan fill="#1f77b4" font-weight="bold">128</tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="109" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;)&#160;<tspan fill="#FF0000" font-weight="bold">as</tspan>&#160;(bx,&#160;by):<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="128" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#d62728" font-weight="bold">A_shared</tspan>&#160;<tspan fill="#666666">=</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">alloc_shared</tspan>((block_M,&#160;block_K))<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="147" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#d62728" font-weight="bold">B_shared</tspan>&#160;<tspan fill="#666666">=</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">alloc_shared</tspan>((block_K,&#160;block_N))<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="166" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#d62728" font-weight="bold">C_local</tspan>&#160;<tspan fill="#666666">=</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">alloc_fragment</tspan>((block_M,&#160;block_N),&#160;accum_dtype)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="185" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="204" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">annotate_layout</tspan>(<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="223" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="242" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#d62728" font-weight="bold">A_shared</tspan>:&#160;<tspan fill="#FFA500" font-weight="bold">your_customized_layout</tspan>(<tspan fill="#d62728" font-weight="bold">A_shared</tspan>),<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="261" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="280" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="299" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="318" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">use_swizzle</tspan>(panel_size<tspan fill="#666666">=</tspan><tspan fill="#1f77b4" font-weight="bold">10</tspan>,&#160;order<tspan fill="#666666">=</tspan><tspan fill="#BA2121">&quot;</tspan><tspan fill="#BA2121">row</tspan><tspan fill="#BA2121">&quot;</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="337" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="356" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">clear</tspan>(<tspan fill="#d62728" font-weight="bold">C_local</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="375" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#FF0000" font-weight="bold">for</tspan>&#160;k&#160;<tspan fill="#1f77b4" font-weight="bold">in</tspan>&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">Pipelined</tspan>(<tspan fill="#9467bd" font-weight="bold">ceildiv</tspan>(K,&#160;block_K),&#160;num_stages<tspan fill="#666666">=</tspan><tspan fill="#1f77b4" font-weight="bold">3</tspan>):<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="394" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">copy</tspan>(<tspan fill="#d62728" font-weight="bold">A</tspan>[by&#160;<tspan fill="#666666">*</tspan>&#160;block_M,&#160;k&#160;<tspan fill="#666666">*</tspan>&#160;block_K],&#160;<tspan fill="#d62728" font-weight="bold">A_shared</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="413" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">copy</tspan>(<tspan fill="#d62728" font-weight="bold">B</tspan>[k&#160;<tspan fill="#666666">*</tspan>&#160;block_K,&#160;bx&#160;<tspan fill="#666666">*</tspan>&#160;block_N],&#160;<tspan fill="#d62728" font-weight="bold">B_shared</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="432" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">gemm</tspan>(<tspan fill="#d62728" font-weight="bold">A_shared</tspan>,&#160;<tspan fill="#d62728" font-weight="bold">B_shared</tspan>,&#160;<tspan fill="#d62728" font-weight="bold">C_local</tspan>)<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="451" xml:space="preserve"><tspan fill="#bbbbbb"></tspan><tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="470" xml:space="preserve"><tspan fill="#bbbbbb"></tspan>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<tspan fill="#9467bd" font-weight="bold">T</tspan><tspan fill="#666666">.</tspan><tspan fill="#9467bd" font-weight="bold">copy</tspan>(<tspan fill="#d62728" font-weight="bold">C_local</tspan>,&#160;<tspan fill="#d62728" font-weight="bold">C</tspan>[by&#160;<tspan fill="#666666">*</tspan>&#160;block_M,&#160;bx&#160;<tspan fill="#666666">*</tspan>&#160;block_N])<tspan fill="#bbbbbb"></tspan></text>
<text x="0" y="489" xml:space="preserve"><tspan fill="#bbbbbb"></tspan></text></g></svg>
